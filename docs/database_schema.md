# è³‡æ–™åº«çµæ§‹èªªæ˜Žæ–‡ä»¶

æœ¬æ–‡ä»¶æè¿°äº† `gateway register modbus device` ç³»çµ±ä¸­ä½¿ç”¨çš„è³‡æ–™åº«è¡¨æ ¼çµæ§‹ã€‚

## ç³»çµ±æž¶æ§‹ç¸½è¦½

æœ¬ç³»çµ±çš„è³‡æ–™åº«è¨­è¨ˆåˆ†ç‚ºå…­å¤§æ ¸å¿ƒæ¨¡çµ„ï¼Œæ¯å€‹æ¨¡çµ„è² è²¬ç‰¹å®šçš„åŠŸèƒ½é ˜åŸŸï¼š

### 1. ä¼æ¥­èˆ‡çµ„ç¹”ç®¡ç†æ¨¡çµ„

- **ç”¨é€”ï¼š** ç®¡ç†ä¼æ¥­çµ„ç¹”æž¶æ§‹åŠå…¶ç›¸é—œè³‡è¨Š
- **æ ¸å¿ƒè¡¨æ ¼ï¼š**
  - enterprisesï¼ˆä¼æ¥­åŸºæœ¬è³‡æ–™ï¼‰
  - enterprise_sitesï¼ˆç‡Ÿé‹æ“šé»žï¼‰
  - site_facilitiesï¼ˆè¨­æ–½åˆ†å€ï¼‰
  - enterprise_contactsï¼ˆè¯çµ¡äººè³‡è¨Šï¼‰
- **ä¸»è¦åŠŸèƒ½ï¼š**
  - ä¼æ¥­è³‡æ–™ç®¡ç†
  - æ“šé»žä½ç½®ç®¡ç†
  - è¨­æ–½åˆ†å€ç®¡ç†
  - è¯çµ¡äººç®¡ç†

### 2. ç”¨æˆ¶ç®¡ç†æ¨¡çµ„

- **ç”¨é€”ï¼š** ç®¡ç†ç³»çµ±ä½¿ç”¨è€…åŠå…¶æ¬Šé™
- **æ ¸å¿ƒè¡¨æ ¼ï¼š**
  - usersï¼ˆå¸³è™ŸåŸºæœ¬è³‡è¨Šï¼‰
  - user_permissionsï¼ˆåŠŸèƒ½æ¬Šé™ï¼‰
  - password_reset_tokensï¼ˆå¯†ç¢¼é‡ç½®ï¼‰
  - login_logsï¼ˆç™»å…¥è¨˜éŒ„ï¼‰
- **ä¸»è¦åŠŸèƒ½ï¼š**
  - å¸³è™Ÿç®¡ç†
    - åŸºæœ¬è³‡æ–™ç¶­è­·
    - å¯†ç¢¼é‡ç½®æ©Ÿåˆ¶
    - ç™»å…¥æ´»å‹•è¿½è¹¤
  - æ¬Šé™æŽ§åˆ¶
    - è§’è‰²åŸºç¤Žæ¬Šé™
    - åŠŸèƒ½ç´°éƒ¨æ¬Šé™
  - å®‰å…¨æ©Ÿåˆ¶
    - ç™»å…¥è¿½è¹¤
    - ç•°å¸¸åµæ¸¬

### 3. è¨­å‚™è¦æ ¼ç®¡ç†æ¨¡çµ„

- **ç”¨é€”ï¼š** ç®¡ç†è¨­å‚™çš„åŸºæœ¬è¦æ ¼å®šç¾©
- **æ ¸å¿ƒè¡¨æ ¼ï¼š**
  - brandsï¼ˆå“ç‰Œè³‡è¨Šï¼‰
  - equipment_typesï¼ˆè¨­å‚™é¡žåž‹ï¼‰
  - model_specsï¼ˆè¦æ ¼å®šç¾©ï¼‰
  - modelsï¼ˆè¨­å‚™åž‹è™Ÿï¼‰
- **ä¸»è¦åŠŸèƒ½ï¼š**
  - å“ç‰Œç®¡ç†
  - è¨­å‚™é¡žåž‹ç®¡ç†
  - è¦æ ¼å®šç¾©ç¶­è­·
  - åž‹è™Ÿç®¡ç†

### 4. è¨­å‚™å¯¦ä¾‹ç®¡ç†æ¨¡çµ„

- **ç”¨é€”ï¼š** ç®¡ç†å¯¦é«”è¨­å‚™è³‡è¨Šã€é–˜é“å™¨ç‰ˆæœ¬åŠå…¶é€£æŽ¥ç‹€æ…‹ï¼Œä¸¦è¿½è¹¤ç¶­è­·è¨˜éŒ„
- **æ ¸å¿ƒè¡¨æ ¼ï¼š**
  - equipmentï¼ˆå¯¦é«”è¨­å‚™ï¼‰- ç®¡ç†è¨­å‚™åŸºæœ¬è³‡è¨Šèˆ‡å•Ÿç”¨ç‹€æ…‹
  - maintenance_recordsï¼ˆç¶­è­·è¨˜éŒ„ï¼‰- è¿½è¹¤è¨­å‚™å®‰è£èˆ‡ç¶­è­·æ­·å²
  - gatewaysï¼ˆé–˜é“å™¨ï¼‰- è¨˜éŒ„é–˜é“å™¨è³‡è¨Šèˆ‡ç‰ˆæœ¬
  - gateway_update_tasksï¼ˆé–˜é“å™¨æ›´æ–°ä»»å‹™ï¼‰- ç®¡ç†éŸŒé«”èˆ‡æª”æ¡ˆç³»çµ±æ›´æ–°æŽ’ç¨‹
  - gateway_equipment_connectionsï¼ˆè¨­å‚™é€£æŽ¥ç‹€æ…‹ï¼‰- è¨˜éŒ„ Gateway å›žå ±çš„é€£æŽ¥ç‹€æ…‹
- **ä¸»è¦åŠŸèƒ½ï¼š**
  - å¯¦é«”è¨­å‚™è³‡è¨Šç®¡ç†
  - è¨­å‚™ç¶­è­·æ­·ç¨‹è¿½è¹¤
  - é–˜é“å™¨ç‰ˆæœ¬æŽ§åˆ¶èˆ‡æ›´æ–°
  - è¨­å‚™é€£æŽ¥ç‹€æ…‹ç›£æŽ§
- **é—œéµç‰¹æ€§ï¼š**
  - æ”¯æ´è¨­å‚™å•Ÿç”¨/åœç”¨ç®¡ç†
  - å®Œæ•´çš„ç¶­è­·è¨˜éŒ„è¿½è¹¤
  - è‡ªå‹•åŒæ­¥ Gateway é€£æŽ¥ç‹€æ…‹
  - é–˜é“å™¨ç‰ˆæœ¬æ›´æ–°æŽ’ç¨‹

### 5. é€šçŸ¥ç³»çµ±æ¨¡çµ„

- **ç”¨é€”ï¼š** ç®¡ç†ç³»çµ±è­¦å ±åŠé€šçŸ¥æ©Ÿåˆ¶
- **æ ¸å¿ƒè¡¨æ ¼ï¼š**
  - notification_rule_defaultsï¼ˆé è¨­è¦å‰‡ï¼‰
  - notification_rulesï¼ˆé€šçŸ¥è¦å‰‡ï¼‰
- **ä¸»è¦åŠŸèƒ½ï¼š**
  - é è¨­è¦å‰‡ç®¡ç†
  - å®¢è£½è¦å‰‡é…ç½®

### 6. ç›£æŽ§èˆ‡æ•¸æ“šæ¨¡çµ„

- **ç”¨é€”ï¼š** å…¨æ–¹ä½ç®¡ç†è¨­å‚™èˆ‡é–˜é“å™¨çš„é‹è¡Œç‹€æ…‹ã€æ•¸æ“šæ”¶é›†ã€é ç«¯æŽ§åˆ¶åŠé€šçŸ¥ç®¡ç†
- **æ ¸å¿ƒè¡¨æ ¼ï¼š**
  - equipment_metricsï¼ˆè¨­å‚™å³æ™‚æ•¸æ“šï¼‰- å„²å­˜è¨­å‚™æ™‚é–“åºåˆ—æ•¸æ“š
  - gateway_status_logsï¼ˆé–˜é“å™¨ç‹€æ…‹ï¼‰- è¿½è¹¤é–˜é“å™¨é‹è¡Œç‹€æ…‹
  - equipment_status_logsï¼ˆè¨­å‚™ç‹€æ…‹ï¼‰- è¿½è¹¤è¨­å‚™é‹è¡Œç‹€æ…‹
  - notification_logsï¼ˆé€šçŸ¥è¨˜éŒ„ï¼‰- ç®¡ç†è­¦å ±é€šçŸ¥ç™¼é€
  - gateway_update_logsï¼ˆé–˜é“å™¨æ›´æ–°ï¼‰- è¨˜éŒ„æ›´æ–°çµæžœ
  - equipment_control_logsï¼ˆè¨­å‚™æŽ§åˆ¶ï¼‰- è¨˜éŒ„é ç«¯æŽ§åˆ¶æ“ä½œ
- **ä¸»è¦åŠŸèƒ½ï¼š**
  - å³æ™‚æ•¸æ“šæŽ¡é›†èˆ‡å­˜å„²
  - é–˜é“å™¨èˆ‡è¨­å‚™ç‹€æ…‹ç›£æŽ§
  - è¨­å‚™é‹è¡Œæ­·å²è¨˜éŒ„è¿½è¹¤
  - è¨­å‚™é ç«¯æŽ§åˆ¶èˆ‡è¿½è¹¤
  - è­¦å ±é€šçŸ¥ç®¡ç†
  - é–˜é“å™¨æ›´æ–°è¿½è¹¤
- **é—œéµç‰¹æ€§ï¼š**
  - æŽ¡ç”¨æ™‚é–“åºåˆ—å„²å­˜æ ¼å¼
  - æ”¯æ´ JSONB æ ¼å¼çš„å‹•æ…‹æ•¸æ“šèˆ‡æŒ‡ä»¤
  - å®Œæ•´çš„æ“ä½œçµæžœè¿½è¹¤
  - è©³ç´°çš„æ™‚é–“æˆ³è¨˜è¨˜éŒ„

## è³‡æ–™è¡¨è©³ç´°èªªæ˜Ž

### ä¼æ¥­èˆ‡çµ„ç¹”ç®¡ç†æ¨¡çµ„

1. `enterprises` è¡¨

- **ç”¨é€”:** å„²å­˜ä¼æ¥­åŸºæœ¬è³‡è¨Š
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `name` (TEXT) - ä¼æ¥­åç¨±ã€‚
  - `tax_id` (TEXT) - çµ±ä¸€ç·¨è™Ÿã€‚
  - `description` (TEXT) - ä¼æ¥­æè¿°ã€‚
  - `is_active` (BOOLEAN) - ä¼æ¥­è³‡è¨Šæ˜¯å¦æœ‰æ•ˆã€‚
  - `created_by` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨) - å»ºç«‹è€…
  - `created_at`(TIMESTAMP WITH TIME ZONE) - å»ºç«‹æ™‚é–“ã€‚
  - `updated_by` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨) - æœ€å¾Œæ›´æ–°è€…
  - `updated_at`(TIMESTAMP WITH TIME ZONE) - æœ€å¾Œæ›´æ–°æ™‚é–“ã€‚

2. `enterprise_sites` è¡¨

- **ç”¨é€”:** å„²å­˜ä¼æ¥­çš„å„å€‹ç‡Ÿé‹æ“šé»ž
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `enterprise_id` (INTEGER, å¤–éµ) - é—œè¯çš„ä¼æ¥­ IDã€‚
  - `site_name` (TEXT) - æ“šé»žåç¨±ã€‚
  - `site_type` (TEXT) - æ“šé»žé¡žåž‹ã€‚
  - `location_info` (JSONB) - ä½ç½®ç›¸é—œå®Œæ•´è³‡è¨Šï¼ŒåŒ…å«ï¼š
    - `address`: å®Œæ•´åœ°å€ã€‚
    - `coordinate`: åº§æ¨™ç›¸é—œã€‚
      - lat: ç·¯åº¦åº§æ¨™ã€‚
      - lon: ç¶“åº¦åº§æ¨™ã€‚
    - `region`: è¡Œæ”¿å€åŸŸã€‚
      - country: åœ‹å®¶ã€‚
      - state: å·ž/çœã€‚
      - city: åŸŽå¸‚ã€‚
      - district: å€ã€‚
      - postal_code: éƒµéžå€è™Ÿã€‚
    - `public_contact` (JSONB) - å…¬å…±è¯çµ¡æ–¹å¼ï¼ŒåŒ…å«ï¼š
      - main_phone: ç¸½æ©Ÿé›»è©±ã€‚
      - service_phone: å®¢æœé›»è©±ã€‚
      - emergency_phone: ç·Šæ€¥è¯çµ¡é›»è©±ã€‚
      - fax: å‚³çœŸè™Ÿç¢¼ã€‚
      - email: å…¬å…±ä¿¡ç®±ã€‚
      - business_hours: ç‡Ÿæ¥­æ™‚é–“è¨­å®šã€‚
        - regular_hours: ä¸€èˆ¬ç‡Ÿæ¥­æ™‚é–“ã€‚
          - monday: ["09:00-12:00", "13:00-18:00"]
          - tuesday: ["09:00-12:00", "13:00-18:00"]
          - wednesday: ["09:00-12:00", "13:00-18:00"]
          - thursday: ["09:00-12:00", "13:00-18:00"]
          - friday: ["09:00-12:00", "13:00-18:00"]
          - saturday: ["09:00-12:00"]
          - sunday: []
        - special_dates: ç‰¹æ®Šæ—¥æœŸè¨­å®šã€‚
          - holidays: ["2024-01-01", "2024-02-14"]
          - custom_hours: [
            {
            "date": "2024-02-13",
            "hours": ["09:00-12:00"]
            }
            ]
        - emergency_service: ç·Šæ€¥æœå‹™æ™‚é–“ã€‚
          - available: true
          - hours: ["18:00-09:00"]
  - `is_active` (BOOLEAN) - æ˜¯å¦ç‚ºç¾è¡Œæ“šé»žã€‚
  - `created_by` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨) - å»ºç«‹è€…
  - `created_at`(TIMESTAMP WITH TIME ZONE) - å»ºç«‹æ™‚é–“ã€‚
  - `updated_by` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨) - æœ€å¾Œæ›´æ–°è€…
  - `updated_at`(TIMESTAMP WITH TIME ZONE) - æœ€å¾Œæ›´æ–°æ™‚é–“ã€‚

3. `site_facilities` è¡¨

- **ç”¨é€”:** ç®¡ç†æ“šé»žå…§çš„è¨­æ–½åˆ†å€
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `enterprise_sites_id` (INTEGER, å¤–éµ, åƒè€ƒ enterprise_sites è¡¨)
  - `name` (TEXT) - è¨­æ–½åç¨±ï¼Œå¦‚ï¼šã€Œæ³¨å¡‘è»Šé–“ã€ã€ã€ŒåŽŸæ–™å€‰ã€
  - `floor` (TEXT) - æ¨“å±¤
  - `facility_type` (TEXT) - è¨­æ–½é¡žåž‹ï¼ˆå¦‚ï¼šç”Ÿç”¢è»Šé–“ã€å€‰å„²ã€å…¬å…±è¨­æ–½å€ç­‰ï¼‰
  - `description` (TEXT) - è¨­æ–½æè¿°
  - `is_active` (BOOLEAN) - æ­¤è¨­æ–½æ˜¯å¦æœ‰æ•ˆ
  - `created_by` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨)
  - `created_at` (TIMESTAMP WITH TIME ZONE)
  - `updated_by` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨)
  - `updated_at` (TIMESTAMP WITH TIME ZONE)

4. `enterprise_contacts` è¡¨

- **ç”¨é€”:** å„²å­˜ä¼æ¥­æ“šé»žçš„è¯çµ¡äººè³‡è¨Šã€‚
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `site_id` (INTEGER, å¤–éµ) - é—œè¯çš„æ“šé»ž IDã€‚
  - `user_id` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨) - è‹¥æ­¤è¯çµ¡äººéœ€è¦ç³»çµ±å­˜å–æ¬Šé™ï¼Œå‰‡é—œè¯åˆ°ä½¿ç”¨è€…å¸³è™Ÿ
  - `contact_info` (JSONB) - è¯çµ¡è³‡è¨Šï¼ŒåŒ…å«ï¼š
    - `basic`: åŸºæœ¬è³‡è¨Šã€‚
      - name: å§“åã€‚
      - title: è·ç¨±ã€‚
      - department: éƒ¨é–€ã€‚
      - employee_id: å“¡å·¥ç·¨è™Ÿã€‚
    - `contact`: è¯çµ¡æ–¹å¼ã€‚
      - office_phone: è¾¦å…¬å®¤é›»è©±ã€‚
      - extension: åˆ†æ©Ÿã€‚
      - fax: å‚³çœŸã€‚
      - mobile: æ‰‹æ©Ÿã€‚
      - email: é›»å­éƒµä»¶ã€‚
      - messaging_apps: é€šè¨Šè»Ÿé«”çš„è¯çµ¡æ–¹å¼ã€‚
        - type: ä¾‹å¦‚ï¼šLINEã€WeChatã€WhatsAppã€Telegramã€Skype ç­‰ã€‚
        - id: ID æˆ–å¸³è™Ÿã€‚
  - `rank_order` (INTEGER) - è·ä½æŽ’åºï¼ˆä¸»è¦ç”¨æ–¼é«˜å±¤ï¼‰ã€‚
  - `is_primary` (BOOLEAN) - æ˜¯å¦ç‚ºä¸»è¦è¯çµ¡äººã€‚
  - `is_active` (BOOLEAN) - æ˜¯å¦åœ¨è·/æœ‰æ•ˆã€‚
  - `created_by` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨) - å»ºç«‹è€…
  - `created_at`(TIMESTAMP WITH TIME ZONE) - å»ºç«‹æ™‚é–“ã€‚
  - `updated_by` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨) - æœ€å¾Œæ›´æ–°è€…
  - `updated_at`(TIMESTAMP WITH TIME ZONE) - æœ€å¾Œæ›´æ–°æ™‚é–“ã€‚

### ç”¨æˆ¶ç®¡ç†æ¨¡çµ„

1. `users` è¡¨

- **ç”¨é€”:** å„²å­˜ä½¿ç”¨è€…å¸³è™Ÿè³‡è¨Š
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `email` (TEXT, UNIQUE) - ç™»å…¥å¸³è™Ÿï¼ˆä½¿ç”¨ emailï¼‰
  - `password_hash` (TEXT) - åŠ å¯†å¾Œçš„å¯†ç¢¼
  - `role` (ENUM) - ä½¿ç”¨è€…è§’è‰²ï¼Œå¦‚ï¼š
    - SUPER_ADMIN - ç³»çµ±æœ€é«˜ç®¡ç†è€…
    - ADMIN - ç®¡ç†è€…
    - SITE_ADMIN - æ“šé»žç®¡ç†è€…
    - SITE_USER - æ“šé»žä¸€èˆ¬ä½¿ç”¨è€…
  - `site_id` (INTEGER, å¤–éµ, åƒè€ƒ enterprise_sites è¡¨) - é—œè¯çš„æ“šé»ž
  - `last_login` (TIMESTAMP WITH TIME ZONE) - æœ€å¾Œç™»å…¥æ™‚é–“
  - `is_active` (BOOLEAN) - å¸³è™Ÿæ˜¯å¦æœ‰æ•ˆ
  - `created_at` (TIMESTAMP WITH TIME ZONE) - å»ºç«‹æ™‚é–“
  - `updated_at` (TIMESTAMP WITH TIME ZONE) - æ›´æ–°æ™‚é–“

2. `user_permissions` è¡¨

- **ç”¨é€”:** å®šç¾©ä½¿ç”¨è€…çš„ç´°éƒ¨æ¬Šé™
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `user_id` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨)
  - `permission_type` (ENUM) - æ¬Šé™é¡žåž‹ï¼Œå¦‚ï¼š
    - VIEW_DASHBOARD - æŸ¥çœ‹å„€è¡¨æ¿
    - EXPORT_DATA - åŒ¯å‡ºæ•¸æ“š
    - MANAGE_EQUIPMENT - ç®¡ç†è¨­å‚™
    - MANAGE_USERS - ç®¡ç†ä½¿ç”¨è€…
    - MANAGE_ALERTS - ç®¡ç†è­¦å ±è¨­å®š
  - `created_at` (TIMESTAMP WITH TIME ZONE) - å»ºç«‹æ™‚é–“

3. `password_reset_tokens` è¡¨

- **ç”¨é€”ï¼š** ç®¡ç†å¯†ç¢¼é‡ç½®è«‹æ±‚
- **æ¬„ä½ï¼š**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `user_id` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨)
  - `token` (TEXT) - é‡ç½® token
  - `expired_at` (TIMESTAMP WITH TIME ZONE) - token éŽæœŸæ™‚é–“
  - `is_used` (BOOLEAN) - æ˜¯å¦å·²ä½¿ç”¨
  - `created_at` (TIMESTAMP WITH TIME ZONE)

4. `login_logs` è¡¨

- **ç”¨é€”ï¼š** è¨˜éŒ„ä½¿ç”¨è€…ç™»å…¥æ´»å‹•
- **æ¬„ä½ï¼š**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `user_id` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨)
  - `login_at` (TIMESTAMP WITH TIME ZONE) - ç™»å…¥æ™‚é–“
  - `ip_address` (TEXT) - ä¾†æº IP
  - `user_agent` (TEXT) - ç€è¦½å™¨è³‡è¨Š
  - `status` (TEXT) - ç™»å…¥ç‹€æ…‹ï¼š'SUCCESS', 'FAILED'
  - `fail_reason` (TEXT, nullable) - å¤±æ•—åŽŸå› 

### è¨­å‚™è¦æ ¼ç®¡ç†æ¨¡çµ„

1. `brands` è¡¨

- **ç”¨é€”:** å„²å­˜å“ç‰Œè³‡è¨Šã€‚
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `name` (TEXT) - å“ç‰Œåç¨±ï¼Œå¦‚ï¼šJAGUARã€HITACHIã€FUSHENG ç­‰ã€‚

2. `equipment_types` è¡¨

- **ç”¨é€”:** å„²å­˜è¨­å‚™é¡žåž‹è³‡è¨Šã€‚
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `name` (TEXT, è¨­å‚™é¡žåž‹åç¨±) - å¦‚ï¼šç©ºå£“æ©Ÿã€ä¹¾ç‡¥æ©Ÿã€æµé‡è¨ˆç­‰ã€‚

3. `model_specs` è¡¨

- **ç”¨é€”:** å„²å­˜è¨­å‚™åž‹è™Ÿçš„å®Œæ•´è¦æ ¼å®šç¾©ã€‚
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `static_specs` (JSONB, å„²å­˜éœæ…‹è¦æ ¼å®šç¾©) - å„²å­˜ä¸æœƒæ”¹è®Šçš„è¦æ ¼ï¼Œå¦‚é¦¬åŠ›ã€å†·å»æ–¹å¼ç­‰å›ºå®šåƒæ•¸ã€‚
  - `dynamic_specs` (JSONB, å„²å­˜å‹•æ…‹è¦æ ¼å®šç¾©) - å„²å­˜å¯è®Šå‹•çš„è¦æ ¼ï¼Œå¦‚æŽ’æ°£å£“åŠ›ã€é›»æµã€å•Ÿå‹• / åœæ­¢ç­‰ã€‚
  - `is_active` (BOOLEAN) - è¡¨ç¤ºæ­¤è¦æ ¼å®šç¾©æ˜¯å¦ä»åœ¨ä½¿ç”¨ä¸­ã€‚
  - `effective_date` (TIMESTAMP WITH TIME ZONE) - è¦æ ¼å®šç¾©ç”Ÿæ•ˆæ—¥æœŸã€‚

4. `models` è¡¨

- **ç”¨é€”:** å„²å­˜è¨­å‚™åž‹è™Ÿè³‡è¨Šã€‚
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `name` (TEXT) - åž‹è™Ÿåç¨±ï¼Œå¦‚ï¼šAC-2023Xã€‚
  - `description` (TEXT) - è©²åž‹è™Ÿæè¿°èªªæ˜Žã€‚
  - `brand_id` (INTEGER, å¤–éµ, åƒè€ƒ `brands` è¡¨) - é—œè¯åˆ°å“ç‰Œè³‡è¨Šã€‚
  - `equipment_type_id` (INTEGER, å¤–éµ, åƒè€ƒ `equipment_types` è¡¨) - é—œè¯åˆ°è¨­å‚™é¡žåž‹ã€‚
  - `specs_id` (INTEGER, å¤–éµ, åƒè€ƒ `model_specs` è¡¨) - é—œè¯åˆ°ç•¶å‰ä½¿ç”¨çš„è¦æ ¼å®šç¾©

æ³¨æ„ï¼šç•¶è¦æ ¼æœ‰æ›´æ–°æ™‚ï¼Œåªéœ€è¦æ›´æ–° specs_id æŒ‡å‘æ–°çš„ model_specs è¨˜éŒ„ï¼Œä¸éœ€è¦å»ºç«‹æ–°çš„ models è¨˜éŒ„ ðŸ”„ã€‚

### è¨­å‚™å¯¦ä¾‹ç®¡ç†æ¨¡çµ„

1. `equipment` è¡¨

- **ç”¨é€”:** å„²å­˜å¯¦é«”è¨­å‚™è³‡è¨Šã€‚
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `facility_id` (INTEGER, å¤–éµ, åƒè€ƒ site_facilities è¡¨) - é—œè¯åˆ°å®¢æˆ¶è³‡è¨Š
  - `model_id` (INTEGER, å¤–éµ, åƒè€ƒ `models` è¡¨) - é—œè¯åˆ°è¨­å‚™çš„åž‹è™Ÿè³‡è¨Šã€‚
  - `name`(TEXT) - è¨­å‚™åç¨±ï¼Œå¯è‡ªå®šç¾©ï¼Œå¦‚ï¼šã€Œä¸€æ¨“ç©ºå£“æ©Ÿã€ã€‚
  - `serial_number` (TEXT) - è¨­å‚™åºè™Ÿã€‚
  - `purchase_date`(DATE) - è¨­å‚™è³¼è²·æ—¥æœŸã€‚
  - `is_active` (BOOLEAN) - è¨­å‚™æ˜¯å¦åœ¨é‹ä½œä¸­ï¼ˆç”¨æ–¼è¨­å‚™å ±å»¢ã€ç§»é™¤æˆ–æš«åœç›£æŽ§æ™‚ï¼Œå¯ä¿ç•™æ­·å²æ•¸æ“šï¼‰ã€‚
  - `created_by` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨) - å»ºç«‹è€…
  - `created_at`(TIMESTAMP WITH TIME ZONE) - å»ºç«‹æ™‚é–“ã€‚
  - `updated_by` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨) - æœ€å¾Œæ›´æ–°è€…
  - `updated_at`(TIMESTAMP WITH TIME ZONE) - æœ€å¾Œæ›´æ–°æ™‚é–“ã€‚

2. `maintenance_records` è¡¨

- **ç”¨é€”:** è¿½è¹¤è¨­å‚™çš„ç¶­è­·æ­·å²è¨˜éŒ„ã€‚
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž) - ç¶­è­·è¨˜éŒ„å”¯ä¸€è­˜åˆ¥ç¢¼ã€‚
  - `equipment_id` (INTEGER, å¤–éµ, åƒè€ƒ `equipment` è¡¨) - é—œè¯åˆ°è¢«ç¶­è­·çš„è¨­å‚™ã€‚
  - `installation_date` (DATE) - è¨­å‚™å®‰è£æ—¥æœŸã€‚
  - `maintenance_date` (DATE) - ç¶­è­·æ—¥æœŸã€‚
  - `maintenance_type` (TEXT) - ç¶­è­·é¡žåž‹ï¼ˆå¦‚ï¼šå®šæœŸä¿é¤Šã€ç·Šæ€¥ç¶­ä¿®ã€‚
  - `description` (TEXT) - ç¶­è­·å…§å®¹æè¿°ã€‚
  - `maintained_by` (TEXT) - ç¶­è­·äººå“¡ã€‚
  - `created_at` (TIMESTAMP WITH TIME ZONE) - è¨˜éŒ„å»ºç«‹æ™‚é–“ã€‚

3. `gateways` è¡¨

- **ç”¨é€”:** å„²å­˜é–˜é“å™¨è³‡è¨Šã€‚
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `macid` (TEXT)
  - `facility_id` (INTEGER, å¤–éµ, åƒè€ƒ site_facilities è¡¨) - æ‰€åœ¨è¨­æ–½ã€‚
  - `firmware_version`(TEXT) - éŸŒé«”ç‰ˆæœ¬ã€‚
  - `FS_version`(TEXT) - æª”æ¡ˆç³»çµ±ç‰ˆæœ¬ã€‚
  - `created_by` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨) - å»ºç«‹è€…
  - `created_at`(TIMESTAMP WITH TIME ZONE) - å»ºç«‹æ™‚é–“ã€‚
  - `updated_by` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨) - æœ€å¾Œæ›´æ–°è€…
  - `updated_at`(TIMESTAMP WITH TIME ZONE) - æœ€å¾Œæ›´æ–°æ™‚é–“ã€‚

4. `gateway_update_tasks` è¡¨

- **ç”¨é€”ï¼š** ç®¡ç†é–˜é“å™¨çš„æ›´æ–°ä»»å‹™
- **æ¬„ä½ï¼š**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `gateway_id` (INTEGER, å¤–éµ, åƒè€ƒ gateways è¡¨)
  - `update_type` (ENUM) - æ›´æ–°é¡žåž‹ï¼š
    - FIRMWARE - éŸŒé«”æ›´æ–°ã€‚
    - FILESYSTEM - æª”æ¡ˆç³»çµ±æ›´æ–°ã€‚
  - `target_version` (TEXT) - ç›®æ¨™ç‰ˆæœ¬ã€‚
  - `file_url` (TEXT) - æ›´æ–°æª”æ¡ˆçš„ä¸‹è¼‰è·¯å¾‘ã€‚
  - `schedule_at` (TIMESTAMP WITH TIME ZONE) - é å®šæ›´æ–°æ™‚é–“ã€‚
  - `created_by` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨)
  - `created_at` (TIMESTAMP WITH TIME ZONE)

5. `gateway_equipment_connections` è¡¨

- **ç”¨é€”:** ç®¡ç†é–˜é“å™¨å’Œè¨­å‚™çš„é€£æŽ¥é—œä¿‚ã€‚
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `gateway_id` (INTEGER, å¤–éµ, åƒè€ƒ gateways è¡¨)
  - `equipment_id` (INTEGER, å¤–éµ, åƒè€ƒ equipment è¡¨)
  - `protocol` (ENUM) - é€šè¨Šå”è­°ï¼š
    - MODBUS_TCP
    - MODBUS_RTU
    - OPC_UA
    - CAN
  - `device_address` (TEXT) - è¨­å‚™é€šè¨Šä½å€ï¼ˆå¦‚ï¼šSlave ID æˆ– IPï¼‰ã€‚
  - `polling_interval` (INTEGER) - æ•¸æ“šæŽ¡é›†é–“éš”ï¼ˆç§’ï¼‰ã€‚
  - `is_active` (BOOLEAN) - æ­¤é€£æŽ¥æ˜¯å¦å•Ÿç”¨ä¸­ã€‚
  > **Notice:**
  > æ­¤è¡¨æ ¼è³‡æ–™ç”± Gateway æœ¬åœ°è¨­å®šå¾Œè‡ªå‹•å›žå ±æ›´æ–°ï¼Œä¸æä¾›å¾Œå°æ‰‹å‹•è¨­å®šåŠŸèƒ½ã€‚
  > - é€£æŽ¥ç‹€æ…‹ï¼ˆ`is_active`ï¼‰åæ˜  Gateway å›žå ±çš„å¯¦éš›é€£æŽ¥ç‹€æ³
  > - é€šè¨Šå”è­°å’Œä½å€è¨­å®šéœ€åœ¨ Gateway ä»‹é¢ä¸Šå®Œæˆ
  > - å³æ™‚é€£ç·šç‹€æ…‹è«‹åƒè€ƒ `gateway_status_logs` è¡¨

### é€šçŸ¥ç³»çµ±æ¨¡çµ„

1. `notification_rule_defaults` è¡¨

- **ç”¨é€”:** å„²å­˜è¨­å‚™åž‹è™Ÿçš„é è¨­é€šçŸ¥è¦å‰‡
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ)
  - `model_id` (INTEGER, å¤–éµ, åƒè€ƒ models è¡¨)
  - `name` (TEXT)
  - `conditions` (JSONB) - è§¸ç™¼æ¢ä»¶ï¼Œæ ¹æ“š model_specs çš„ dynamic_specs å®šç¾©ï¼Œæ ¼å¼å¦‚ï¼š
    ```json
    {
      "metric": "pressure", // å°æ‡‰ dynamic_specs ä¸­çš„åƒæ•¸
      "operator": ">", // é‹ç®—ç¬¦ï¼š>, <, =, >=, <=, !=
      "value": 8.5, // é–¾å€¼
      "duration": 300 // æŒçºŒæ™‚é–“ï¼ˆç§’ï¼‰
    }
    ```
  - `severity` (ENUM) - åš´é‡ç¨‹åº¦ï¼š
    - CRITICAL - ç·Šæ€¥
    - WARNING - è­¦å‘Š
    - INFO - æé†’
  - `is_active` (BOOLEAN)
  - `created_by` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨) - å»ºç«‹è€…
  - `created_at`(TIMESTAMP WITH TIME ZONE) - å»ºç«‹æ™‚é–“ã€‚
  - `updated_by` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨) - æœ€å¾Œæ›´æ–°è€…
  - `updated_at`(TIMESTAMP WITH TIME ZONE) - æœ€å¾Œæ›´æ–°æ™‚é–“ã€‚

2. `notification_rules` è¡¨

- **ç”¨é€”:** å„²å­˜è¨­å‚™çš„é€šçŸ¥è¦å‰‡è¨­å®š
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `equipment_id` (INTEGER, å¤–éµ, åƒè€ƒ equipment è¡¨)
  - `name` (TEXT) - è¦å‰‡åç¨±
  - `rule_type` (ENUM) - è¦å‰‡é¡žåž‹ï¼Œå¦‚ï¼š
    - THRESHOLD - é–¾å€¼è­¦å ±
    - STATUS_CHANGE - ç‹€æ…‹è®Šæ›´
    - MAINTENANCE - ä¿é¤Šæé†’
  - `conditions` (JSONB) - è§¸ç™¼æ¢ä»¶ï¼Œæ ¹æ“š model_specs çš„ dynamic_specs å®šç¾©ï¼Œæ ¼å¼å¦‚ï¼š
    ```json
    {
      "metric": "pressure", // å°æ‡‰ dynamic_specs ä¸­çš„åƒæ•¸
      "operator": ">", // é‹ç®—ç¬¦ï¼š>, <, =, >=, <=, !=
      "value": 8.5, // é–¾å€¼
      "duration": 300 // æŒçºŒæ™‚é–“ï¼ˆç§’ï¼‰
    }
    ```
  - `severity` (ENUM) - åš´é‡ç¨‹åº¦ï¼š
    - CRITICAL - ç·Šæ€¥
    - WARNING - è­¦å‘Š
    - INFO - æé†’
  - `notification_methods` (JSONB) - é€šçŸ¥æ–¹å¼è¨­å®šï¼š
    ```json
    {
      "email": true,
      "sms": false,
      "line": true,
      "webhook": false
    }
    ```
  - `recipients` (JSONB) - é€šçŸ¥å°è±¡è¨­å®šï¼Œæ ¼å¼å¦‚ï¼š
    ```json
    {
      "users": [1, 2, 3], // user_id åˆ—è¡¨
      "contacts": [5, 8], // enterprise_contacts.id åˆ—è¡¨
      "webhook_urls": ["https://..."] // è‹¥æœ‰ webhook å‰‡è¨˜éŒ„ç›®æ¨™ URL
    }
    ```
  - `is_active` (BOOLEAN) - è¦å‰‡æ˜¯å¦å•Ÿç”¨
  - `created_by` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨) - å»ºç«‹è€…
  - `created_at`(TIMESTAMP WITH TIME ZONE) - å»ºç«‹æ™‚é–“ã€‚
  - `updated_by` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨) - æœ€å¾Œæ›´æ–°è€…
  - `updated_at`(TIMESTAMP WITH TIME ZONE) - æœ€å¾Œæ›´æ–°æ™‚é–“ã€‚

### ç›£æŽ§èˆ‡æ•¸æ“šæ¨¡çµ„

1. `gateway_status_logs` è¡¨

- **ç”¨é€”:** è¿½è¹¤é–˜é“å™¨ç‹€æ…‹è®ŠåŒ–ã€‚
- **ç‰¹æ€§:**
  - ä½¿ç”¨æ™‚é–“åºåˆ—å„²å­˜æ ¼å¼ã€‚
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `gateway_id` (INTEGER, å¤–éµ, åƒè€ƒ `gateways` è¡¨) - é—œè¯åˆ°ç‰¹å®šé–˜é“å™¨ã€‚
  - `status` (ENUM) - é–˜é“å™¨ç‹€æ…‹ï¼Œå¦‚ï¼š
    - ONLINE - åœ¨ç·šã€‚
    - OFFLINE - é›¢ç·šã€‚
    - ERROR - éŒ¯èª¤ã€‚
    - MAINTENANCE - ç¶­è­·ä¸­ã€‚
  - `recorded_at` (TIMESTAMP WITH TIME ZONE) - ç‹€æ…‹è¨˜éŒ„æ™‚é–“ã€‚

2. `equipment_status_logs` è¡¨

- **ç”¨é€”:** è¿½è¹¤è¨­å‚™ç‹€æ…‹è®ŠåŒ–ã€‚
- **ç‰¹æ€§:**
  - ä½¿ç”¨æ™‚é–“åºåˆ—å„²å­˜æ ¼å¼ã€‚
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `equipment_id` (INTEGER, å¤–éµ, åƒè€ƒ `equipment` è¡¨) - é—œè¯åˆ°ç‰¹å®šè¨­å‚™ã€‚
  - `status` (ENUM) - è¨­å‚™ç‹€æ…‹ï¼Œå¦‚ï¼š
    - RUNNING - é‹è½‰ä¸­ã€‚
    - STOPPED - åœæ­¢ã€‚
    - ERROR - ç•°å¸¸ã€‚
    - MAINTENANCE - ç¶­è­·ä¸­ã€‚
    - STANDBY - å¾…æ©Ÿã€‚
  - `recorded_at` (TIMESTAMP WITH TIME ZONE) - ç‹€æ…‹è¨˜éŒ„æ™‚é–“ã€‚

3. `equipment_metrics` è¡¨

- **ç”¨é€”:** å„²å­˜å¾žè¨­å‚™æŽ¡é›†çš„å³æ™‚æ•¸æ“šï¼ˆæ™‚é–“åºåˆ—è³‡æ–™ï¼‰
- **ç‰¹æ€§:**
  - ä½¿ç”¨æ™‚é–“åºåˆ—å„²å­˜æ ¼å¼
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `mapping_id` (INTEGER, å¤–éµ, åƒè€ƒ gateway_equipment_mappings è¡¨)
  - `metrics_data` (JSONB) - å‹•æ…‹æ•¸æ“šå…§å®¹ï¼Œå°æ‡‰ model_specs è¡¨ä¸­çš„ dynamic_specs å®šç¾©
  - `recorded_at` (TIMESTAMP WITH TIME ZONE) - æ•¸æ“šæŽ¡é›†æ™‚é–“æˆ³è¨˜

4. `notification_logs` è¡¨

- **ç”¨é€”:** è¨˜éŒ„é€šçŸ¥ç™¼é€æ­·å²
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `rule_id` (INTEGER, å¤–éµ, åƒè€ƒ notification_rules è¡¨)
  - `equipment_id` (INTEGER, å¤–éµ, åƒè€ƒ equipment è¡¨)
  - `triggered_value` (JSONB) - è§¸ç™¼æ™‚çš„æ•¸å€¼
  - `message` (TEXT) - é€šçŸ¥è¨Šæ¯å…§å®¹
  - `status` (ENUM) - ç™¼é€ç‹€æ…‹ï¼š
    - PENDING - å¾…ç™¼é€
    - SENT - å·²ç™¼é€
    - FAILED - ç™¼é€å¤±æ•—
  - `sent_at` (TIMESTAMP WITH TIME ZONE) - ç™¼é€æ™‚é–“
  - `created_at` (TIMESTAMP WITH TIME ZONE) - è¨˜éŒ„å»ºç«‹æ™‚é–“

5. `gateway_update_logs` è¡¨

- **ç”¨é€”ï¼š** è¨˜éŒ„æ›´æ–°éŽç¨‹çš„è©³ç´°ç‹€æ…‹è®ŠåŒ–
- **æ¬„ä½ï¼š**
  - `id` (INTEGER, ä¸»éµ, è‡ªå‹•éžå¢ž)
  - `task_id` (INTEGER, å¤–éµ, åƒè€ƒ gateway_update_tasks è¡¨)
  - `status` (ENUM) - ç•¶å‰ç‹€æ…‹
    - COMPLETED - å®Œæˆ
    - FAILED - å¤±æ•—
  - `error_message` (TEXT, nullable) - éŒ¯èª¤è¨Šæ¯
  - `completed_at` (TIMESTAMP WITH TIME ZONE, nullable) - å®Œæˆæ™‚é–“
  - `created_at` (TIMESTAMP WITH TIME ZONE)

6. `equipment_control_logs` è¡¨
- **ç”¨é€”:** è¨˜éŒ„è¨­å‚™é ç«¯æŽ§åˆ¶æ“ä½œ
- **æ¬„ä½:**
  - `id` (INTEGER, ä¸»éµ)
  - `mapping_id` (INTEGER, å¤–éµ, åƒè€ƒ gateway_equipment_mappings è¡¨)
  - `command` (JSONB) - æŽ§åˆ¶æŒ‡ä»¤å…§å®¹
  - `result` (ENUM) - åŸ·è¡Œçµæžœï¼š
    - SUCCESS - æˆåŠŸ
    - FAILED - å¤±æ•—
  - `error_message` (TEXT, nullable) - éŒ¯èª¤è¨Šæ¯
  - `created_by` (INTEGER, å¤–éµ, åƒè€ƒ users è¡¨)
  - `created_at` (TIMESTAMP WITH TIME ZONE)

## æœªä¾†åŠŸèƒ½åƒè€ƒ (Future Features)

### æ“ä½œæ—¥èªŒç³»çµ± (Operation Logging System)

- **å„ªå…ˆç´šï¼š** ä¸­ç­‰
- **ç›®çš„ï¼š** è¿½è¹¤ç³»çµ±é‡è¦æ“ä½œï¼Œæä¾›ç¨½æ ¸åŠŸèƒ½
- **å»ºè­°å¯¦ä½œç¯„åœï¼š**
  1. è¨­å‚™ç”Ÿå‘½é€±æœŸç®¡ç†ï¼ˆæ–°å¢ž/åˆªé™¤/åœç”¨ï¼‰
  2. é–˜é“å™¨é…ç½®è®Šæ›´
  3. ä½¿ç”¨è€…æ¬Šé™ç•°å‹•
  4. é‡è¦åƒæ•¸èª¿æ•´

#### è³‡æ–™è¡¨åƒè€ƒè¨­è¨ˆ

```sql
CREATE TABLE operation_logs (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    action TEXT,           -- æ“ä½œé¡žåž‹
    description TEXT,      -- æ“ä½œæè¿°
    resource_type TEXT,    -- è³‡æºé¡žåž‹
    resource_id INTEGER,   -- è³‡æº ID
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```
